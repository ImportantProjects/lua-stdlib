#!/bin/sh

# Copy this script to $HOME/.luamultienv, and adjust to match any Lua
# environments you wish to rerun supporting testsuites under, with:
#
#    make check-local

: ${LUA='lua'}

export PATH LUA SPECL

set -e

func_check ()
{
  
  title=`$LUA -v 2>&1`
  banner=`echo "$title" | sed 's|.|=|g'`
  printf "\n## %s ##\n## %s ##\n## %s ##\n\n" "$banner" "$title" "$banner"
  echo "make check-local SPECL='$SPECL'"
  make check-local SPECL="$SPECL"
}

rootdir=/usr/local
specldir=specl/3-1


## ============================== ##
## Default checks using Lua 5.1.x ##
## ============================== ##

luadir=$rootdir/opt/lua
rocksdir=$rootdir/lib/lua51rocks/rocks

PATH=$rocksdir/$specldir/bin:$PATH
LUA=$luadir/bin/lua51
SPECL="$LUA $rocksdir/$specldir/bin/specl"

func_check


## ================================ ##
## Additional checks with Lua 5.2.x ##
## ================================ ##

luadir=$rootdir/opt/lua52
rocksdir=$rootdir/lib/luarocks/rocks

PATH=$rocksdir/$specldir/bin:$PATH
LUA=$luadir/bin/lua
SPECL="$LUA $rocksdir/$specldir/bin/specl"

func_check

exit $?
