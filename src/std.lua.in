--- Lua standard library
-- <ul>
-- <li>TODO: Write a style guide (indenting/wrapping, capitalisation,
--   function and variable names); library functions should call
--   error, not die; OO vs non-OO (a thorny problem).</li>
-- <li>TODO: Add tests for each function immediately after the function;
--   this also helps to check module dependencies.</li>
-- <li>TODO: pre-compile.</li>
-- </ul>
local version = "General Lua libraries / @VERSION@"

for _, m in ipairs (require "modules") do
  _G[m] = require (m)
end

-- Inject stdlib extensions directly into global package namespaces.
_G.io      = _G.io_ext
_G.math    = _G.math_ext
_G.package = _G.package_ext
_G.string  = _G.string_ext
_G.table   = _G.table_ext

-- Add io functions to the file handle metatable.
local file_metatable = getmetatable (io.stdin)
file_metatable.readlines  = io.readlines
file_metatable.writelines = io.writelines

-- Maintain old global interface access points.
for _, api in ipairs {
  "assert",
  "ileaves",
  "leaves",
  "pickle",
  "prettytostring",
  "render",
  "require_version",
  "tostring",
} do
  _G[api] = _G[api] or list[api]
  _G[api] = _G[api] or string_ext[api]
end

local M = {
  version = version,
}

return M
